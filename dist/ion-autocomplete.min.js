!function(){"use strict";angular.module("ion-autocomplete",[]).directive("ionAutocomplete",["$ionicBackdrop","$ionicScrollDelegate","$document","$q","$parse","$interpolate","$ionicPlatform","$compile","$templateRequest",function(a,b,c,d,e,f,g,h,i){return{require:["ngModel","ionAutocomplete"],restrict:"A",scope:{},bindToController:{ngModel:"=",externalModel:"=",templateData:"=",itemsMethod:"&",itemsClickedMethod:"&",itemsClickedActionMethod:"&",itemsRemovedMethod:"&",modelToItemMethod:"&",cancelButtonClickedMethod:"&",placeholder:"@",extraActionLabel:"@",cancelLabel:"@",selectItemsLabel:"@",selectedItemsLabel:"@",defaultText:"@",headerText:"@",placeholderModal:"@",firstChildClass:"@",showSearchBar:"@"},controllerAs:"viewModel",controller:["$attrs","$timeout","$scope",function(a,b,c){var d=function(a,b){return a?a:b},e=this;b(function(){e.defaultText=d(e.defaultText,"Default text no result"),e.placeholder=d(e.placeholder,"Click to enter a value..."),e.cancelLabel=d(e.cancelLabel,"Ok"),e.selectItemsLabel=d(e.selectItemsLabel,"Selecciona un medicamento"),"false"===e.selectedItemsLabel&&(e.hideItemLabel=!0),e.selectedItemsLabel=d(e.selectedItemsLabel,f("Selected items:")(e))}),this.maxSelectedItems=d(a.maxSelectedItems,void 0),this.templateUrl=d(a.templateUrl,void 0),this.itemsMethodValueKey=d(a.itemsMethodValueKey,void 0),this.itemValueKey=d(a.itemValueKey,void 0),this.itemViewValueKey=d(a.itemViewValueKey,void 0),this.componentId=d(a.componentId,void 0),this.loadingIcon=d(a.loadingIcon,void 0),this.manageExternally=d(a.manageExternally,"false"),this.ngModelOptions=d(c.$eval(a.ngModelOptions),{}),this.showLoadingIcon=!1,this.searchItems=[],this.selectedItems=[],this.searchQuery=void 0,this.isArray=function(a){return angular.isArray(a)}}],link:function(a,f,j,k){var l=k[0],m=k[1];m.randomCssClass="ion-autocomplete-random-"+Math.floor(1e3*Math.random()+1),m.isIOS=ionic.Platform.isIOS();var n=['<div class="autocomplete">','<div class="ion-autocomplete-container '+m.randomCssClass+' modal" style="display: none;">','<div align-title="center" + ng-if='+m.isIOS+' class="ios-header">',"</div>",'<div align-title="center" class="bar autocomplete-header">','<h1 class="title text header-autocomplete-text">{{viewModel.headerText}}</h1>','<button class="button ion-close icon" ng-click="viewModel.cancelClick()"></button>',"</div>",'<div class="bar bar-header item-input-inset transparent-bck input-container" ng-if="viewModel.showSearchBar">','<label class="item-input-wrapper search-label-auto input-label-auto">','<input type="search" class="ion-autocomplete-search" ng-model="viewModel.searchQuery" ng-model-options="viewModel.ngModelOptions" placeholder="{{viewModel.placeholderModal}}"/>','<i class="icon ion-search search-icon"></i>',"</label>",'<div class="ion-autocomplete-loading-icon" ng-if="viewModel.showLoadingIcon && viewModel.loadingIcon"><ion-spinner icon="{{viewModel.loadingIcon}}"></ion-spinner></div>',"</div>",'<ion-content keyboard-resize delegate-handle="autocompleteModal" class="double-header" ng-class="viewModel.hasSearchBar()">','<ion-item class="item-divider" ng-hide="viewModel.hideItemLabel">{{viewModel.selectedItemsLabel}}</ion-item>','<ion-item ng-if="viewModel.isArray(viewModel.selectedItems)" ng-repeat="selectedItem in viewModel.selectedItems track by $index" class="item-icon-left item-icon-right item-text-wrap">','<i class="icon ion-checkmark"></i>',"{{viewModel.getItemValue(selectedItem, viewModel.itemViewValueKey)}}",'<i class="icon ion-trash-a" style="cursor:pointer" ng-click="viewModel.removeItem($index)"></i>',"</ion-item>",'<ion-item ng-if="!viewModel.isArray(viewModel.selectedItems) && !viewModel.hideItemLabel" class="item-icon-left item-icon-right item-text-wrap">','<i class="icon ion-checkmark"></i>',"{{viewModel.getItemValue(viewModel.selectedItems, viewModel.itemViewValueKey)}}",'<i class="icon ion-trash-a" style="cursor:pointer" ng-click="viewModel.removeItem(0)"></i>',"</ion-item>",'<ion-item ng-repeat="item in searchItems = (viewModel.searchItems | filter:viewModel.searchQuery:strict) track by $index" item-height="50px" item-width="100%" ng-class="viewModel.firstChildClass($index)" class="item-text-wrap item-list-formatted">','<div ng-if=!item.moreInfo ng-click="viewModel.selectItem(item)"  >','<span ng-bind-html="viewModel.getItemValue(item, viewModel.itemViewValueKey)"></span>',"</div>","<div ng-if=item.moreInfo>",'<div class="row">','<div class="col col-67" ng-click="viewModel.selectItem(item)">','<span class="center-span" ng-bind-html="viewModel.getItemValue(item, viewModel.itemViewValueKey)"></span>',"</div>",'<div class="col col-33" ng-click="viewModel.selectItemExtra(item)">','<span class="autocomplete-info" ><i class="icon icon ion-search search-icon more-info"></i></span>',"</div>","</div>","</div>","</ion-item>","</ion-content>","</div>","</div>"].join("");d.when().then(function(){return m.templateUrl?i(m.templateUrl):n}).then(function(i){var k=h(angular.element(i))(a);c.find("body").append(k),m.firstChildClass=function(a){return 0===a?j.firstChildClass:""},m.hasSearchBar=function(){if(!angular.isDefined(m.showSearchBar))return"top-70"},m.getItemValue=function(a,b){if(angular.isArray(a)){var c=[];return angular.forEach(a,function(d){b&&angular.isObject(a)?c.push(e(b)(d)):c.push(d)}),c}return b&&angular.isObject(a)?e(b)(a):a},m.selectItem=function(a){m.searchQuery=void 0,"1"!=m.maxSelectedItems&&angular.isArray(m.selectedItems)&&m.maxSelectedItems==m.selectedItems.length||(s(m.selectedItems,m.itemValueKey,m.getItemValue(a,m.itemValueKey))||("1"==m.maxSelectedItems?m.selectedItems=a:m.selectedItems=m.selectedItems.concat([a])),l.$setViewValue(m.selectedItems),l.$render(),1==m.maxSelectedItems&&m.hideModal(),angular.isDefined(j.itemsClickedMethod)&&m.itemsClickedMethod({callback:{item:a,selectedItems:angular.isArray(m.selectedItems)?m.selectedItems.slice():m.selectedItems,componentId:m.componentId}}))},m.selectItemExtra=function(a){m.itemsClickedActionMethod({callback:{item:a,componentId:m.componentId}})},m.removeItem=function(a){if(angular.isArray(m.selectedItems)){var b=m.selectedItems.splice(a,1)[0];m.selectedItems=m.selectedItems.slice()}else m.selectedItems=[];l.$setViewValue(m.selectedItems),l.$render(),angular.isDefined(j.itemsRemovedMethod)&&m.itemsRemovedMethod({callback:{item:b,selectedItems:angular.isArray(m.selectedItems)?m.selectedItems.slice():m.selectedItems,componentId:m.componentId}})},a.$watch("viewModel.searchQuery",function(a){m.fetchSearchQuery(a,!1)}),m.fetchSearchQuery=function(a,c){if(void 0!==a&&angular.isDefined(j.itemsMethod)){m.showLoadingIcon=!0;var e={query:a,isInitializing:c};m.componentId&&(e={query:a,isInitializing:c,componentId:m.componentId});var f=d.when(m.itemsMethod(e));f.then(function(a){a&&(a&&a.data&&(a=a.data),m.searchItems=m.getItemValue(a,m.itemsMethodValueKey),b.resize(),m.showLoadingIcon=!1)},function(a){return d.reject(a)})}};var n=!1;m.showModal=function(){if(!n){angular.element(c[0].querySelector("div.ion-autocomplete-container."+m.randomCssClass)).css("display","block"),a.$deregisterBackButton=g.registerBackButtonAction(function(){m.hideModal()},300);var d=angular.element(c[0].querySelector("div.ion-autocomplete-container."+m.randomCssClass+" input"));d.length>0&&(d[0].focus(),setTimeout(function(){d[0].focus()},0)),b.resize(),n=!0}},m.hideModal=function(){angular.element(c[0].querySelector("div.ion-autocomplete-container."+m.randomCssClass)).css("display","none"),m.searchQuery=void 0,a.$deregisterBackButton&&a.$deregisterBackButton(),n=!1};var o={moved:!1,startX:0,startY:0},p=function(a){o.moved=!1,"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),o.startX=a.touches[0].clientX,o.startY=a.touches[0].clientY},q=function(a){"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),(Math.abs(a.touches[0].clientX-o.startX)>10||Math.abs(a.touches[0].clientY-o.startY)>10)&&(o.moved=!0)},r=function(a){o.moved||(a.preventDefault(),a.stopPropagation(),m.fetchSearchQuery("",!0),m.showModal())},s=function(a,b,c){if(angular.isArray(a))for(var d=0;d<a.length;d++)if(m.getItemValue(a[d],b)===c)return!0;return!1},t=function(a){var b=d.when(m.modelToItemMethod({modelValue:a}));b.then(function(a){m.selectItem(a)},function(a){return d.reject(a)})};"false"==m.manageExternally&&(f.bind("touchstart",p),f.bind("touchmove",q),f.bind("touchend click focus",r)),m.cancelClick=function(){m.hideModal(),angular.isDefined(j.cancelButtonClickedMethod)&&m.cancelButtonClickedMethod({callback:{selectedItems:angular.isArray(m.selectedItems)?m.selectedItems.slice():m.selectedItems,componentId:m.componentId}})},a.$watch("viewModel.externalModel",function(a){return angular.isArray(a)&&0==a.length?(m.selectedItems=[],l.$setViewValue(m.selectedItems),void l.$render()):void(a&&angular.isDefined(j.modelToItemMethod)&&(angular.isArray(a)?(m.selectedItems=[],angular.forEach(a,function(a){t(a)})):t(a)))}),a.$on("$destroy",function(){k.remove()}),l.$render=function(){f.val(m.getItemValue(l.$viewValue,m.itemViewValueKey))},l.$formatters.push(function(a){var b=m.getItemValue(a,m.itemViewValueKey);return void 0==b?"":b}),l.$parsers.push(function(a){return m.getItemValue(a,m.itemValueKey)})})}}}])}();
